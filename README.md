# Idealized Mixed Layer Carbon Isotope Box Model

Our idealized mixed layer carbon isotope enabled box model is based on the work by Lynch-Stieglitz et al. (1995):

> Lynch-Stieglitz, J., T. F. Stocker, W. S. Broecker, and R. G. Fairbanks (1995), The influence of air-sea exchange on the isotopic composition of oceanic carbon: Observations and modeling, Global Biogeochem. Cycles, 9(4), 653–665, doi:10.1029/95GB02574.

We have extended this model to include seasonal temperature and salinity forcing based on a sine wave, as well as seasonal wind speed (7 m/s from March through September and 10.5 m/s from October through February), vertical mixing (0.1 µmol kg⁻¹ day⁻¹ DIC from October through February), and biological production (0.1 µmol kg⁻¹ day⁻¹ DIC from March through September and 0.01 µmol kg⁻¹ day⁻¹ DIC for the rest of the year) parameterized based on the values used in Cai et al. (2020):

> Cai, WJ., Xu, YY., Feely, R.A. et al. (2020). Controls on surface water carbonate chemistry along North American ocean margins. Nat Commun 11, 2691. https://doi.org/10.1038/s41467-020-16530-z.

### Model Description

Our model simulates a generic water column from the mixed layer with a depth of 30 m, a surface area of 1 m² (values can be adjusted in 'constants.py' file), a fixed atmospheric pCO₂ of 395 μatm, and initial conditions set to achieve equilibrium with atmospheric values. The model includes state variables for dissolved inorganic carbon (DIC), alkalinity (ALK), δ13C-DIC, and Δ14C-DIC. It assumes chemical and isotopic equilibrium for all timescales relevant to our experiments, calculated using PyCO2SYS (Humphreys et al., 2022).

Following Cai et al. 2020, the model is initiated with the carbonate system defined by pCO2 in equilibrium with atmospheric values and alkalinity defined by initial salinity. ΔDICBio and ΔDICVertical are prescribed while ΔpCO2_Air-Sea is calculated at each time step using the relationship ΔpCO2_Air-Sea = 0.24 * kappa * K0 * (pCO2_t(aq) - (pCO2_(atm)). K0 is the CO2 gas solubility and kappa is defined as kappa = 0.251 * W2 * (Sc/660)-0.5 where W is wind speed in m/s and Sc is the Schmidt number. Total alkalinity is calculated from prescribed salinity.

Isotopic fractionation is considered using equilibrium and kinetic fractionation factors for δ13C and δ14C.

## Running the Model

To run the model, follow these steps:

1. **Clone the repository:**

    ```bash
    git clone https://github.com/RyanAGreen/mld-box-model-c-isotopes.git
    cd mld-box-model-c-isotope
    ```

2. **Install the required dependencies:**

    ```bash
    pip install -r requirements.txt
    ```

3. **Adjust model parameters:**
   
  You can adjust the parameters in the `if __name__ == "__main__":` block of the `model.py` file to suit your needs. You can easily change the length of the simulation with `spin_up_years` and `simulation_length_years`, and you can change the initial conditions for the isotopes in the mixed layer box with `d13C_ocean` and `D14C_ocean`.

4. **Run the model:**

    ```bash
    python src/model.py
    ```

An overview figure will be generated and saved in the `data/plots` directory. Additionally, a text file containing the model results will be saved in the `data` directory for further analysis.

## Code Structure

The table below explains the files and directories included in this project.

| Directory/File | Description |
|---|---|
| `README.md` | Project documentation (this file) |
| `LICENSE` | License information |
| `requirements.txt` | Dependencies for the project |
| `data` | Directory for data used or generated by the model |
| `src` | Source code for the model |
| `src/model.py` | Main model code |
| `src/utils` | Utility functions or modules |
| `src/utils/constants.py` | Constants used in the model |
| `src/utils/fluxes.py` | Flux calculations for the model |
| `src/utils/data_input.py` | Data input functions |
| `src/utils/data_output.py` | Data output functions |
| `src/utils/plotting.py` | Plotting functions |
| `src/__init__.py` | Python package initialization file |
| `notebooks` | Jupyter notebooks for analysis or examples |
| `docs` | Additional documentation or research papers |
| `examples` | Example scripts using the model |
| `scripts` | Useful scripts for data preprocessing, visualization, etc. |

## Adjusting the Model

To adjust the model for your specific requirements, you can modify the parameters in the `src/model.py` file. Key parameters include:

- `spin_up_years`: Number of years to run the model for spin-up.
- `simulation_length_years`: Number of years for the actual simulation.
- `d13C_ocean`: Initial δ13C of DIC in box model.
- `D14C_ocean`: Initial ∆14C of DIC in box model.

## Output

The model generates:

- **Overview Figure**: Saved in the `data/plots` directory. This figure shows the seasonal salinity and SST forcing, DIC and δ13C model tracers, and pCO2, pH, and Ωarag generated with PyCO2SYS from the simulated DIC and ALK with the seasonal salinity and SST forcings. This figure is similar to Fig 6a,b,c from [Cai et al., 2020](https://doi.org/10.1038/s41467-020-16530-z).
- **Text File of Results**: Saved in the `data` directory. This only contains the model tracers (DIC, alkalinity, d13C, and D14C), salinity and SST forcing, and time in units of years. Other carbonate parameters can be calculated from these DIC, alkalinty, salinity and SST using PyCO2SYS/CO2SYS or another CO2 solver.  

Both outputs are designed for further data analysis and visualization.

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

## Contributing

Contributions are welcome! Please read the [CONTRIBUTING](docs/CONTRIBUTING.md) guide to get started.

## Contact

For any questions or issues, please open an issue in the GitHub repository.
